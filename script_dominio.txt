--criar campos cofre
alter table notasaidanfe add cofre integer;
alter table notaentradanfe add cofre integer;
alter table pdv.vendanfce add cofre integer;


--criar funcoes dos gatilhos
CREATE OR REPLACE FUNCTION dominio_gatilho() RETURNS trigger AS $dominio_gatilho$
    BEGIN
		IF(NEW.id_situacaonfe <> OLD.id_situacaonfe) THEN
			NEW.cofre := 0;
        END IF;
        RETURN NEW;
    END;
$dominio_gatilho$ LANGUAGE plpgsql;


CREATE OR REPLACE FUNCTION dominio_nfce_gatilho() RETURNS trigger AS $dominio_nfce_gatilho$
    BEGIN
		IF(NEW.id_situacaonfce <> OLD.id_situacaonfce) THEN
			NEW.cofre := 0;
        END IF;
        RETURN NEW;
    END;
$dominio_nfce_gatilho$ LANGUAGE plpgsql;


--criar gatilhos
   create TRIGGER dominio_gatilho BEFORE UPDATE ON notasaidanfe
    FOR EACH ROW EXECUTE PROCEDURE dominio_gatilho();
   
   create TRIGGER dominio_gatilho BEFORE UPDATE ON notaentradanfe
    FOR EACH ROW EXECUTE PROCEDURE dominio_gatilho();
   
   create TRIGGER dominio_nfce_gatilho BEFORE UPDATE ON pdv.vendanfce
    FOR EACH ROW EXECUTE PROCEDURE dominio_nfce_gatilho();


CREATE schema IF NOT EXISTS dominio_api;

CREATE TABLE IF NOT EXISTS dominio_api.token(token text);

INSERT INTO dominio_api.token(token) VALUES ('eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IlJERTBPVEF3UVVVMk16Z3hPRUpGTkVSRk5qUkRNakkzUVVFek1qZEZOVEJCUkRVMlJrTTRSZyJ9.eyJpc3MiOiJodHRwczovL2F1dGgudGhvbXNvbnJldXRlcnMuY29tLyIsInN1YiI6InpEbE1OeDBRR09Vam9XQ0NsV0VDNmRQTVZjeUZkOU1CQGNsaWVudHMiLCJhdWQiOiI0MDlmOTFmNi1kYzE3LTQ0YzgtYTVkOC1lMGExYmFmZDhiNjciLCJpYXQiOjE2OTkwMTY4OTcsImV4cCI6MTY5OTEwMzI5NywiYXpwIjoiekRsTU54MFFHT1Vqb1dDQ2xXRUM2ZFBNVmN5RmQ5TUIiLCJzY29wZSI6Imh0dHBzOi8vYXBpLnRob21zb25yZXV0ZXJzLmNvbS9hdXRoL29udmlvLWJyLmludm9pY2UtaW50ZWdyYXRpb24ud3JpdGUiLCJndHkiOiJjbGllbnQtY3JlZGVudGlhbHMifQ.P4OpYCqbexcAGSOFh3lKfE79Vht6VH9fpdSXiII5wb_Ftyqme6ZvPHah3i20bcUcXLpccGfn84JJVQhFokyIEGEmRpVGXfrOQikdfWMIv7gnPoPKJPmBOYOpBxhjAfh7RI3Fx8zXmsLhNm1vrMJVa7no4VDsdJfeZ7zJKkqXVKmI0mQ8ThC4soMsX8cDwH6o-PmpHh-toYw4XZ6X4-OIxoN3fGuVn9IDetnMtQbbQWf_4oruRtJ-Z-V9h6ORR7OwYMi9J0UiORIXjgqpvlUn9WincK7_mmmrVT-Xcn6HrQnN-LFWlzVfDiL6yJejdxJEFkPJR22twVm5lByiC4DHOA');


